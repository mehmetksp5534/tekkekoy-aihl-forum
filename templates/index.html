<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tekkek√∂y Anadolu ƒ∞mam Hatip Lisesi Forum</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body {
            background: linear-gradient(135deg, #6E81FF 0%, #DFF7F7 100%) !important;
            min-height: 100vh;
        }

        .main-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 80px;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 20px;
        }

        .sidebar {
            width: 100%;
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .sidebar-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .sidebar-panel h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        .category-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .category-list li {
            padding: 8px 10px;
            margin-bottom: 5px;
            background: #f9f9f9;
            border-left: 3px solid #6E81FF;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            color: #333;
            font-size: 13px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        .category-list li:hover {
            background: #e8e8ff;
            border-left-color: #DFF7F7;
            transform: translateX(5px);
        }

        .mini-games {
            padding: 10px;
            text-align: center;
        }

        .game-btn {
            display: block;
            width: 100%;
            padding: 8px;
            margin-bottom: 6px;
            background: linear-gradient(135deg, #6E81FF 0%, #DFF7F7 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.3s ease;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .online-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: #d4edda;
            border-left: 3px solid #28a745;
            border-radius: 4px;
            color: #155724;
            font-size: 12px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        .online-dot {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .content {
            flex: 1;
            min-width: 0;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .container {
            max-width: 100%;
            margin: 0;
        }

        .search-section {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .search-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .search-group {
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #6E81FF;
            box-shadow: 0 0 8px rgba(110, 129, 255, 0.3);
        }

        .search-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #6E81FF 0%, #DFF7F7 100%);
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(110, 129, 255, 0.4);
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-select {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .filter-select:focus {
            outline: none;
            border-color: #6E81FF;
            box-shadow: 0 0 8px rgba(110, 129, 255, 0.3);
        }

        .form-section {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .form-section h2,
        .topics-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .form-group input[type="text"],
        .form-group input[type="file"],
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: Arial, sans-serif;
            box-sizing: border-box;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-group input[type="submit"] {
            background: #333;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .form-group input[type="submit"]:hover {
            background: #555;
        }

        .topics-section {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .topics-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .topic-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .topic-item:hover {
            background: #f9f9f9;
        }

        .topic-item:last-child {
            border-bottom: none;
        }

        .topic-info {
            flex: 1;
        }

        .topic-category {
            display: inline-block;
            background: #333;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-right: 10px;
        }

        .topic-title {
            color: #0066cc;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            margin: 5px 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .topic-title:hover {
            text-decoration: underline;
        }

        .topic-title.solved {
            color: #27ae60;
        }

        .topic-solved-badge {
            display: inline-block;
            color: #27ae60;
            font-size: 14px;
            margin-left: 8px;
        }

        .ask-teachers-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FF9500 0%, #FFB84D 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 8px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(255, 149, 0, 0.3);
        }

        .topic-meta {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        .topic-stats {
            display: flex;
            gap: 15px;
            margin-top: 8px;
            font-size: 13px;
            color: #666;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        .topic-file {
            color: #999;
            font-size: 12px;
        }

        .topic-actions {
            margin-left: 15px;
            white-space: nowrap;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            text-decoration: none;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
<header>
    <button class="menu-toggle" id="menuToggle" aria-label="Men√ºy√º A√ß/Kapat">‚ò∞</button>
    <h1>Tekkek√∂y Anadolu ƒ∞mam Hatip Lisesi Forum</h1>
    <nav>
        <div class="user-info">
            {% if user_profile_photo %}
                <img src="{{ url_for('uploaded_file', filename=user_profile_photo) }}" alt="Avatar" class="avatar" title="{{ user_name }}">
            {% else %}
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='30' r='20' fill='%23fff'/%3E%3Cpath d='M10 100 Q10 70 50 70 Q90 70 90 100' fill='%23fff'/%3E%3C/svg%3E" alt="Avatar" class="avatar" title="{{ user_name }}">
            {% endif %}
            <span>{{ user_name }}</span>
        </div>
        <a href="{{ url_for('dashboard') }}">Profil</a>
        <a href="{{ url_for('logout') }}">√áƒ±kƒ±≈ü Yap</a>
    </nav>
</header>

<main class="main-wrapper">
    <!-- SOL PANEL -->
    <aside class="sidebar">
        <!-- KATEGORƒ∞LER -->
        <div class="sidebar-panel">
            <h3>üìÅ Kategoriler</h3>
            <ul class="category-list" id="categories">
                <li style="color: #999; text-align: center; border: none;">Y√ºkleniyor...</li>
            </ul>
        </div>

        <!-- Mƒ∞Nƒ∞ GAMES -->
        <div class="sidebar-panel">
            <h3>üéÆ Mini Games</h3>
            <div class="mini-games">
                <a href="{{ url_for('word_game') }}" class="game-btn">üî§ Son Harf Oyunu</a>
            </div>
        </div>

        <!-- ONLINE KULLANICI -->
        <div class="sidebar-panel">
            <div class="online-status">
                <div class="online-dot"></div>
                <div>
                    √áevrimi√ßi: <strong id="online-count">?</strong>
                </div>
            </div>
        </div>
    </aside>

    <!-- ƒ∞√áERƒ∞K ALANI -->
    <div class="content">
        <!-- ARAMA B√ñL√úM√ú -->
        <div class="search-section">
            <h2>üîç Konularƒ± Ara</h2>
            <form method="GET" action="{{ url_for('search_topics') }}" class="search-form">
                <div class="search-group">
                    <input type="text" name="q" placeholder="Konu ba≈ülƒ±ƒüƒ±nda veya i√ßeriƒüinde ara..." value="{{ request.args.get('q', '') }}" class="search-input">
                    <button type="submit" class="search-btn">Ara</button>
                </div>
                <div class="filter-group">
                    <select name="category" class="filter-select">
                        <option value="">T√ºm Kategoriler</option>
                    </select>
                    <select name="sort" class="filter-select">
                        <option value="newest">En Yeni</option>
                        <option value="oldest">En Eski</option>
                        <option value="most_replies">En √áok Cevap</option>
                    </select>
                </div>
            </form>
        </div>

        <!-- Yeni Konu Formu -->
        <div class="form-section">
            <h2>Yeni Konu A√ß</h2>
            <form method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="category">Kategori:</label>
                    <select id="category" name="category" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: Arial, sans-serif;">
                        <option value="">-- Kategori Se√ßin --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="title">Konu Ba≈ülƒ±ƒüƒ±:</label>
                    <input type="text" id="title" name="title" placeholder="Sorunuz veya konunuzun ba≈ülƒ±ƒüƒ±..." required>
                </div>

                <div class="form-group">
                    <label for="content">ƒ∞√ßerik:</label>
                    <textarea id="content" name="content" placeholder="Detaylƒ± a√ßƒ±klama yazƒ±n..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="attachment">Dosya Ekle (isteƒüe baƒülƒ±):</label>
                    <input type="file" id="attachment" name="attachment" accept=".png,.jpg,.jpeg,.gif,.pdf,.zip,.txt">
                    <small style="color: #666;">PNG, JPG, JPEG, GIF, PDF, ZIP, TXT kabul edilir (Maksimum 16MB)</small>
                </div>

                <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="is_anonymous" name="is_anonymous" value="on">
                    <label for="is_anonymous" style="margin-bottom: 0;">Anonim olarak g√∂nder (Admin onayƒ± beklenir)</label>
                </div>

                <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="ask_teachers" name="ask_teachers" value="on">
                    <label for="ask_teachers" style="margin-bottom: 0;">üè´ Hocalara Sor (√ñƒüretmenlere haber verilir)</label>
                </div>

                <div class="form-group">
                    <input type="submit" value="Konu Ekle">
                </div>
            </form>
        </div>

        <!-- Forum Konularƒ± -->
        <div class="topics-section">
            <h2>Forum Konularƒ±</h2>
            {% if topics %}
                {% for topic in topics %}
                    <div class="topic-item">
                        <div class="topic-info">
                            <span class="topic-category">{{ topic[2] }}</span>
                            <a href="{{ url_for('show_topic', topic_id=topic[0]) }}" class="topic-title {% if topic|length > 5 and topic[5] == 1 %}solved{% endif %}">
                                {{ topic[1] }}
                                {% if topic|length > 5 and topic[5] == 1 %}<span class="topic-solved-badge">‚úÖ √á√∂z√ºld√º</span>{% endif %}
                                {% if topic|length > 11 and topic[11] == 1 %}<span class="ask-teachers-badge">Hocalara Soru</span>{% endif %}
                            </a>
                            <div class="topic-meta">
                                {% if topic|length > 9 and topic[9] == 1 %}
                                    üìù A√ßan: <span style="color: #666;">Anonim</span>
                                {% else %}
                                    üìù A√ßan: 
                                    <div class="user-widget-container" style="display: inline-block;" data-username="{{ topic[4] }}">
                                        <div class="user-widget">
                                            <img alt="avatar" class="user-avatar-small" style="width: 18px; height: 18px;">
                                            <span class="user-name-text">{{ topic[4] }}</span>
                                        </div>
                                        <div class="mini-profile-card"></div>
                                    </div>
                                {% endif %}
                                {% if topic|length > 8 and topic[8] %}
                                    <span class="topic-file">| üìé {{ topic[8].split('_', 1)[-1] }}</span>
                                {% endif %}
                                {% if user_role == 'admin' and topic|length > 10 and topic[10] == 0 %}
                                    <span style="color: #ff6600; margin-left: 10px;">‚è≥ Onay Bekleniyor</span>
                                {% endif %}
                            </div>
                            <div class="topic-stats">
                                üí¨ <span>{{ topic[-1] }} Cevap</span>
                            </div>
                        </div>
                        {% if user_role == 'admin' %}
                            <div class="topic-actions">
                                <a href="{{ url_for('delete_topic', topic_id=topic[0]) }}" class="delete-btn" onclick="return confirm('Silmek istediƒüinize emin misiniz?')">Sil</a>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <p style="text-align: center; color: #999; padding: 20px;">Hen√ºz konu bulunmamaktadƒ±r.</p>
            {% endif %}
        </div>
    </div>
</main>

<script>
// Hamburger Men√º Toggle ve Sidebar Positioning
function initMobileMenu() {
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.querySelector('.sidebar');
    
    if (!menuToggle) return;
    
    menuToggle.addEventListener('click', function(e) {
        e.stopPropagation();
        sidebar.classList.toggle('open');
        document.body.classList.toggle('menu-open');
    });
    
    // Overlay'e tƒ±klandƒ±ƒüƒ±nda men√ºy√º kapat (slide animasyonuyla)
    document.addEventListener('click', function(e) {
        if (sidebar.classList.contains('open') && 
            !sidebar.contains(e.target) && 
            e.target !== menuToggle) {
            sidebar.classList.add('closing');
            setTimeout(() => {
                sidebar.classList.remove('open', 'closing');
                document.body.classList.remove('menu-open');
            }, 300);
        }
    });
    
    // Sidebar linklerine tƒ±klandƒ±ƒüƒ±nda men√ºy√º kapat (slide animasyonuyla)
    sidebar.querySelectorAll('a, li').forEach(element => {
        element.addEventListener('click', function() {
            sidebar.classList.add('closing');
            setTimeout(() => {
                sidebar.classList.remove('open', 'closing');
                document.body.classList.remove('menu-open');
            }, 300);
        });
    });
}

let allTopics = [];
let selectedCategory = null;

// Kategorileri y√ºkle ve dropdown'u doldur
async function loadCategories() {
    try {
        const response = await fetch('/api/categories');
        const categories = await response.json();
        const categoryList = document.getElementById('categories');
        const categorySelect = document.getElementById('category');
        
        if (categories.length === 0) {
            categoryList.innerHTML = '<li style="color: #999; text-align: center; border: none;">Kategori bulunamadƒ±</li>';
            return;
        }
        
        // Sol panel kategorileri doldur
        categoryList.innerHTML = categories.map(cat => 
            `<li onclick="filterByCategory('${cat}')">${cat}</li>`
        ).join('');
        
        // Select dropdown'unu doldur (Yeni Konu ve Arama)
        const selectOptions = categories.map(cat => 
            `<option value="${cat}">${cat}</option>`
        ).join('');
        categorySelect.innerHTML = '<option value="">-- Kategori Se√ßin --</option>' + selectOptions;
        
        // Arama sayfasƒ±nda da doldur
        const searchSelect = document.querySelector('select[name="category"]');
        if (searchSelect) {
            searchSelect.innerHTML = '<option value="">T√ºm Kategoriler</option>' + selectOptions;
        }
    } catch (error) {
        console.error('Kategoriler y√ºklenemedi:', error);
    }
}

// T√ºm konularƒ± y√ºkle
async function loadAllTopics() {
    try {
        const response = await fetch('/');
        // Ana sayfayƒ± yenile yerine, t√ºm konularƒ± API'den √ßek
        // ≈ûimdilik dropdown a√ßƒ±lƒ±rken t√ºm konularƒ± al
    } catch (error) {
        console.error('Konular y√ºklenemedi:', error);
    }
}

// Kategori se√ßildiƒüinde forum konularƒ±nƒ± filtrele
async function filterByCategory(category) {
    selectedCategory = category;
    
    try {
        const response = await fetch(`/api/topics/by-category/${encodeURIComponent(category)}`);
        const topics = await response.json();
        
        // Forum konularƒ± b√∂l√ºm√ºn√º g√ºncelle
        const topicsSection = document.querySelector('.topics-section');
        
        if (topics.length === 0) {
            topicsSection.innerHTML = `
                <h2>Forum Konularƒ± - ${category}</h2>
                <p style="text-align: center; color: #999; padding: 20px;">Bu kategoride hen√ºz konu bulunmamaktadƒ±r.</p>
            `;
            return;
        }
        
        // Konu HTML'ini olu≈ütur
        let topicsHTML = `<h2>Forum Konularƒ± - ${category}</h2>`;
        
        topics.forEach(topic => {
            const isSolved = topic.solved === 1 ? 'solved' : '';
            const solvedBadge = topic.solved === 1 ? '<span class="topic-solved-badge">‚úÖ √á√∂z√ºld√º</span>' : '';
            const askTeachersBadge = topic.ask_teachers === 1 ? '<span class="ask-teachers-badge">Hocalara Soru</span>' : '';
            const authorName = topic.is_anonymous === 1 ? 'Anonim' : `<a href="/profile/${topic.author}" style="color: #0066cc; text-decoration: none;">${topic.author}</a>`;
            const approvalBadge = topic.is_approved === 0 ? '<span style="color: #ff6600; margin-left: 10px;">‚è≥ Onay Bekleniyor</span>' : '';
            
            topicsHTML += `
                <div class="topic-item">
                    <div class="topic-info">
                        <span class="topic-category">${topic.category}</span>
                        <a href="/topic/${topic.id}" class="topic-title ${isSolved}">
                            ${topic.title}
                            ${solvedBadge}
                        </a>
                        <div class="topic-meta">
                            üìù A√ßan: <span style="color: #666;">${authorName}</span>
                            ${approvalBadge}
                        </div>
                        <div class="topic-stats">
                            üí¨ <span>${topic.reply_count} Cevap</span>
                        </div>
                    </div>
                </div>
            `;
        });
        
        topicsSection.innerHTML = topicsHTML;
    } catch (error) {
        console.error('Kategori konularƒ± y√ºklenemedi:', error);
    }
}

// T√ºm konularƒ± g√∂ster
function showAllTopics() {
    selectedCategory = null;
    location.reload(); // Sayfayƒ± yenile (t√ºm konularƒ± g√∂ster)
}

// Online kullanƒ±cƒ± sayƒ±sƒ±nƒ± g√ºncelle
async function updateOnlineCount() {
    try {
        const response = await fetch('/api/online-count');
        const data = await response.json();
        document.getElementById('online-count').textContent = data.count;
    } catch (error) {
        console.error('Online sayƒ±sƒ± y√ºklenemedi:', error);
    }
}

// Sayfa y√ºklendiƒüinde
document.addEventListener('DOMContentLoaded', function() {
    initMobileMenu();
    loadCategories();
    updateOnlineCount();
    
    // Her 10 saniyede online sayƒ±sƒ±nƒ± g√ºncelle
    setInterval(updateOnlineCount, 10000);
    
    // Mini profil kartlarƒ±nƒ± y√ºkle
    loadMiniProfileCards();
});

// Mini profil kartlarƒ±nƒ± y√ºkle
function loadMiniProfileCards() {
    document.querySelectorAll('.user-widget-container').forEach(container => {
        const username = container.getAttribute('data-username');
        if (!username) return;
        
        fetch(`/api/user-widget/${encodeURIComponent(username)}`)
            .then(response => response.json())
            .then(user => {
                if (user.error) return;
                
                // Profil fotoƒürafƒ±nƒ± y√ºkle
                const avatar = container.querySelector('.user-avatar-small');
                if (user.profile_photo) {
                    avatar.src = `/uploads/${user.profile_photo}`;
                } else {
                    avatar.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='30' r='20' fill='%23999'/%3E%3Cpath d='M10 100 Q10 70 50 70 Q90 70 90 100' fill='%23999'/%3E%3C/svg%3E";
                }
                
                // Mini profil kartƒ±nƒ± olu≈ütur
                const card = container.querySelector('.mini-profile-card');
                let cardHTML = `
                    <div class="mini-card-header">
                        <img src="${user.profile_photo ? `/uploads/${user.profile_photo}` : 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2230%22 r=%2220%22 fill=%22%23999%22/%3E%3Cpath d=%22M10 100 Q10 70 50 70 Q90 70 90 100%22 fill=%22%23999%22/%3E%3C/svg%3E'}" 
                             alt="Profil" class="mini-profile-photo">
                        <div class="mini-card-name">${user.name}</div>
                        <div class="mini-card-role">${getRoleLabel(user.role)}</div>
                        <div class="mini-card-xp">‚≠ê ${user.xp} XP</div>
                    </div>
                    
                    <div class="mini-card-stats">
                        <div class="stat-item">
                            <span class="stat-value">${user.xp}</span>
                            <span class="stat-label">XP</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${user.role === 'teacher' ? 'üë®‚Äçüè´' : user.role === 'admin' ? 'üìå' : 'üë®‚Äçüéì'}</span>
                            <span class="stat-label">Rol</span>
                        </div>
                    </div>
                `;
                
                // Rozetleri g√∂ster
                if (user.all_badges && user.all_badges.length > 0) {
                    cardHTML += `
                        <div class="mini-card-badges">
                            <div class="badges-title">Rozetler</div>
                            <div class="badges-grid">
                                ${user.all_badges.slice(0, 4).map(badge => `
                                    <div class="mini-badge-icon" title="${badge.name}">
                                        <img src="${badge.icon}" style="width: 100%; height: 100%; object-fit: contain;">
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                cardHTML += `
                    <div style="margin-top: 12px; text-align: center;">
                        <a href="/profile/${user.name}" style="color: #6E81FF; text-decoration: none; font-size: 12px; font-weight: bold;">
                            Profili G√∂r√ºnt√ºle ‚Üí
                        </a>
                    </div>
                `;
                
                card.innerHTML = cardHTML;
            })
            .catch(error => console.error('Kullanƒ±cƒ± widget y√ºklenemedi:', error));
    });
}

function getRoleLabel(role) {
    const labels = {
        'student': 'üë®‚Äçüéì √ñƒürenci',
        'teacher': 'üë®‚Äçüè´ √ñƒüretmen',
        'admin': 'üìå Admin'
    };
    return labels[role] || role;
}
</script>
</body>
</html>
